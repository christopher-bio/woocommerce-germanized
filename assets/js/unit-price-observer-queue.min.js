window.germanized=window.germanized||{},function(t,o){o.unit_price_observer_queue={queue:{},timeout:null,params:{},request:null,init:function(){this.params=wc_gzd_unit_price_observer_queue_params,this.queue={},this.timeout=null,this.request=null},execute:function(){var c=o.unit_price_observer_queue,r=[],a={...c.queue};c.queue={},c.timeout=null,Object.keys(a).forEach(function(e){r=r.concat([{product_id:a[e].productId,price:a[e].priceData.price,price_sale:a[e].priceData.sale_price,quantity:a[e].priceData.quantity,key:e}])}),c.request=t.ajax({type:"POST",url:c.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:c.params.refresh_unit_price_nonce,products:r},success:function(n){Object.keys(a).forEach(function(e){var r=a[e],t=r.observer,i=r.priceData,u=r.priceSelector,r=r.isPrimary,i=c.getUnitPricesFromMap(i.unit_price);t&&(n.products.hasOwnProperty(e)?(e=n.products[e],t.stopObserver(t,u),parseInt(e.product_id)===t.getCurrentProductId(t)&&e.hasOwnProperty("unit_price_html")?t.unsetUnitPriceLoading(t,i,e.unit_price_html):t.unsetUnitPriceLoading(t,i)):(t.stopObserver(t,u),t.unsetUnitPriceLoading(t,i)),t.startObserver(t,u,r))})},error:function(){Object.keys(a).forEach(function(e){var r=a[e],t=r.observer,i=r.priceData,e=r.priceSelector,r=r.isPrimary,i=c.getUnitPricesFromMap(i.unit_price);t&&(t.stopObserver(t,e),t.unsetUnitPriceLoading(t,i),t.startObserver(t,e,r))})},dataType:"json"})},getUnitPricesFromMap:function(e){let r=[];return e.forEach(function(e){r=t.merge(r,t(e))}),t(r)},getQueueKey:function(e){return(e+"").replace(/[^a-zA-Z0-9]/g,"")},add:function(e,r,t,i,u){var n,c=o.unit_price_observer_queue,a=c.getQueueKey(r);c.queue.hasOwnProperty(a)?t.unit_price.each(function(e,r){c.queue[a].priceData.unit_price.has(r)||c.queue[a].priceData.unit_price.set(r,r)}):(n=new Map,t.unit_price.each(function(e,r){n.set(r,r)}),t.unit_price=n,c.queue[a]={productId:r,observer:e,priceData:t,priceSelector:i,isPrimary:u}),clearTimeout(c.timeout),c.timeout=setTimeout(c.execute,500)}},t(document).ready(function(){o.unit_price_observer_queue.init()})}(jQuery,window.germanized);